<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <span class="js-weather"></span>
    <script>
        const weather = document.querySelector('.js-weather')
        const API_KEY = '4289fbaf0434c162a4f9bfef0453f3c3';
        const COORDS = 'coords';

        init();

        function getWeather(lat, lng) {
            fetch(
                `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lng}&appid=${API_KEY}&units=metric`
                ).then(function(response) {
                    return response.json();
                }).then(function(json) {
                    const temperature = json.main.temp;
                    const place = json.name;
                    weather.innerText = `${temperature} â„ƒ @ ${place}`;
                });
        
        }

        function saveCoords(coordsObj) {
            localStorage.setItem(COORDS, JSON.stringify(coordsObj));
        }

        function handleGeoError(position) {
            console.log("cant access geo loaction");
        }

        function handleGeoSucces(position) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            const coordsObj = {
                latitude,
                longitude
            };
            saveCoords(coordsObj);
            getWeather(latitude, longitude);
        }

        function askForCoords() {
            navigator.geolocation.getCurrentPosition(handleGeoSucces, handleGeoError);
        }

        function loadCoords() {
            const loadedCoords = localStorage.getItem(COORDS);
            if (loadedCoords === null) {
                askForCoords();
            } else {
                const parseCoords = JSON.parse(loadedCoords);
                getWeather(parseCoords.latitude, parseCoords.longitude);
            }
        }

        function init() {
            loadCoords();
        }
    </script>
</body>
</html>